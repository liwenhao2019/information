# 网络拓扑测量

网络拓扑测量的主要功能是通过采集和分析网络设备之间的连接关系和通信路径，了解网络的结构和运行状态。其核心功能包括以下几个方面：

1. **发现网络拓扑结构** ：通过探测和记录网络节点（如路由器、交换机、服务器等）以及它们之间的连接，构建网络的拓扑图。这有助于了解网络的物理布局和逻辑结构。
2. **路径测量** ：通过工具（如Traceroute）探测从源节点到目标节点的通信路径，帮助识别数据包在网络中的传输路径以及路径中涉及的中间设备。
3. **网络性能监控** ：测量网络中的延迟、抖动、丢包率等性能指标，帮助识别网络瓶颈、提高服务质量（QoS），并通过拓扑结构来分析性能问题所在的网络环节。
4. **自治域（AS）测量** ：通过采集自治系统之间的路由关系，绘制互联网上AS的连接结构，帮助理解全球互联网的分布和流量路由情况。
5. **异常检测与安全分析** ：通过定期进行网络拓扑测量，检测网络结构的异常变化，如不明设备的出现或通信路径的改变，这有助于网络安全监控和入侵检测。
6. **地理位置映射**：通过将IP地址与地理位置关联，确定网络节点的物理位置。这样可以帮助管理员和研究人员了解网络节点的全球分布，特别是在广域网（WAN）或互联网中的跨境路由分析中起到关键作用。常用的技术有GeoIP数据库或IP地址注册信息。

## 地理位置映射

地理位置映射是通过将网络节点的IP地址与已知的地理信息数据库（如GeoIP数据库或IP地址注册表）进行匹配，从而确定该IP地址对应的物理位置。具体操作包括查找IP地址的归属地，确定其所在的国家、城市或更精确的地理坐标。这种映射技术通常依赖于互联网注册机构分配的IP地址范围与其对应的区域的公开数据，以及运营商的网络拓扑信息。

### 1. 基于信息的定位方法

通过直接查询网络地址注册机构提供的注册者的信息对IP地址的地理位置进行推测：

* **GeoCluster** ：
  GeoCluster是一种基于IP地址的地理位置聚类数据集，旨在通过分析不同网络节点的延迟、路由信息和地理位置特征，将相邻或同一区域的IP地址进行聚类。其原理是通过网络测量数据来推断IP地址的物理位置，而非依赖注册信息，通常用于研究互联网的拓扑结构和流量分布。GeoCluster可以帮助理解特定区域内的网络性能、延迟差异以及网络设备的物理分布。
* **NetGeo** ：
  NetGeo（Network Geography）是一个历史上用于将IP地址映射到地理位置的服务，早期通过查询Whois数据库等来源，获取IP地址对应的网络注册信息来推断地理位置。它曾为网络研究人员和工程师提供地理位置相关的服务，帮助理解互联网中的自治域（AS）和IP地址的地理分布。然而，NetGeo在近年来的使用逐渐减少，许多新系统已取代了其功能，现有的使用者可能转向更现代的地理位置数据集。
* **WBG（Whois-Based Geolocation）** ：
  WBG是基于Whois数据库的IP地理位置数据集，它通过分析IP地址的注册信息，提取其中的地理位置信息。Whois数据库包含IP地址的归属信息，包括网络运营商、分配范围、城市和国家等。WBG利用这些信息提供地理位置映射，常用于学术研究和互联网测量项目。虽然基于Whois信息的地理定位在某些情况下可能不够精确，但它仍是理解互联网拓扑和网络管理的重要工具。
  部分研究通过比较定位结果对商业数据库进行了评估，众多研究认为这些数据库只是字粗粒度上满足要求（国家级定位误差不低于95%），细粒度定位结果则不理想。

### 2. 商业数据库

开源的IP地理位置数据集是提供IP地址与其地理位置映射关系的数据库，通常以开源形式发布，允许开发者免费使用、修改和共享。常见的开源数据集包括MaxMind的GeoLite2、IP2Location LITE和DB-IP等，它们提供每个IP地址或IP地址段与国家、城市、经纬度等地理信息的关联。这些数据集广泛应用于地理位置分析、网络安全、广告定向和内容分发等领域。开源IP地理位置数据集的优势在于可自由获取、定期更新和社区支持，使得用户可以根据需要进行自定义扩展。

* **GeoLite2**：由MaxMind提供的免费开源IP地理位置数据库，提供IP地址到国家、城市和经纬度的映射，广泛用于地理定位、内容定向和分析，定期更新。
  * [练鑫鑫.基于被动测量的网络拓扑推断及可视化研究[D].西安电子科技大学,2018](基于被动测量的网络拓扑推断及可视化研究_练鑫鑫.pdf)
* **IP2Location LITE**：IP2Location发布的免费精简版IP地址数据集，支持将IP地址映射到国家、地区、城市和经纬度，适合需要基础定位功能的应用场景。
* **DB-IP**：一个免费的开源IP地理位置数据库，提供IP地址到国家、城市和时区等信息的映射，应用于网络分析、广告投放等场景，拥有定期更新的数据版本。

王志豪,张卫东,文辉,等.IP定位技术研究[J].信息安全学报,2019,4(03):34-47.DOI:10.19363/J.cnki.Cn10-1380/tn.2019.05.03

### 3. 商业API

使用在线第三方提供的API可以快速实现IP地址的地理位置定位。这些API服务通过查询IP地址，返回相应的地理信息，如国家、城市、经纬度等。例如，**ip-api.com** 提供简单易用的IP地址查询接口，**ip.taotao.com** 和 **新浪iplookup** 提供类似的定位服务，常用于中国的IP地址定位，而 **百度地图API** 不仅提供IP地址定位功能，还可以进一步结合其地图服务进行可视化和路线规划。这些API大大简化了IP地址定位的实现，方便开发者集成到自己的应用中。

* **ip-api.com** ：一个全球IP地址查询服务，提供简单易用的API接口，支持通过IP地址获取国家、城市、经纬度、时区、ISP（互联网服务提供商）等信息。它有免费和付费版本，免费版有请求次数限制，但足以满足大部分基本需求。
* **ip.taotao.com** ：由中国的淘淘网提供的IP地址定位服务，主要面向中国用户，通过API接口返回IP地址所属的省、市等地理信息，适合国内应用场景，且支持免费查询。
* **百度地图API** ：百度提供的综合地图服务，除了IP定位功能外，还支持更多高级功能，如实时位置显示、路径规划和地图可视化。开发者可以通过百度地图API获取IP地址的地理位置，并将其结合到地图上进行展示或导航。
* **新浪 iplookup** ：新浪提供的IP地址查询API，特别适合中国国内的IP定位，能够返回IP地址的省、市等基本地理信息。它提供简单的查询接口，广泛应用于网站流量分析和定位服务。

| 服务名称        | 国家   |  省  |   市  |   区县  | 经纬度 | ISP |
| :--------  | :-----:  | :----: | :----: | :----: | :----: | :----: |
| ip-api.com | • | • | • |   | • | • |
| ip.taotao.com | • | • | • |   | • | • |
| 百度地图API | ◦ | • | • | • | • | • |
| 新浪 iplookup | • | • | • | • |   | • |
| GeoLite2 | • | • | • | ◦  | • | • |

博客：[ [使用免费GeoLite2-City.mmdb进行IP信息解析和地理定位](https://www.cnblogs.com/zccoming/p/13338493.html)]

### AS域数据

#### CAIDA匿名互联网追踪数据集
https://www.caida.org/catalog/datasets/passive_dataset/


#### CIDR-AS域数据
https://www.cidr-report.org/as2.0/aggr.html
